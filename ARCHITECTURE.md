# Douglas Mo Digital Twin - 系统架构

## 整体架构图

```
┌─────────────────────────────────────────────────────────────┐
│                    用户界面 (Browser)                        │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐      │
│  │  个人简介页   │  │  技能展示    │  │  项目作品集   │      │
│  └──────────────┘  └──────────────┘  └──────────────┘      │
│  ┌─────────────────────────────────────────────────┐        │
│  │         AI 聊天界面 (ChatInterface)              │        │
│  │  • 实时对话                                      │        │
│  │  • 场景识别                                      │        │
│  │  • 快速问题                                      │        │
│  └─────────────────────────────────────────────────┘        │
└─────────────────────────────────────────────────────────────┘
                            ↓ HTTP/HTTPS
┌─────────────────────────────────────────────────────────────┐
│              Next.js 应用服务器 (Vercel)                      │
│  ┌──────────────────────────────────────────────────────┐   │
│  │  app/page.tsx - 主页面                                │   │
│  │  app/layout.tsx - 应用布局                            │   │
│  └──────────────────────────────────────────────────────┘   │
│  ┌──────────────────────────────────────────────────────┐   │
│  │  API Routes                                           │   │
│  │  └── /api/chat/route.ts                              │   │
│  │      • 接收用户消息                                   │   │
│  │      • 场景类型分析                                   │   │
│  │      • 向量搜索调用                                   │   │
│  │      • LLM生成调用                                    │   │
│  └──────────────────────────────────────────────────────┘   │
│  ┌──────────────────────────────────────────────────────┐   │
│  │  Business Logic (lib/)                                │   │
│  │  ├── vectordb.ts - 向量数据库操作                     │   │
│  │  ├── llm.ts - LLM集成和提示工程                       │   │
│  │  └── utils.ts - 工具函数                              │   │
│  └──────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────┘
            ↓                              ↓
┌──────────────────────┐      ┌──────────────────────┐
│   Upstash Vector DB  │      │     Groq API         │
│   • 向量存储          │      │  • LLM推理            │
│   • 语义搜索          │      │  • Llama 3.1 70B     │
│   • 嵌入生成          │      │  • 快速响应           │
│   • 元数据过滤        │      │  • 免费额度           │
└──────────────────────┘      └──────────────────────┘
```

## 数据流程

### 用户提问流程

```
1. 用户输入问题
   ↓
2. ChatInterface 组件发送到 /api/chat
   ↓
3. API 分析问题类型 (analyzeQuestionType)
   • 电话筛选 (screening)
   • HR面试 (hr)
   • 技术面试 (technical)
   • 管理层面试 (manager)
   • 高管面试 (executive)
   ↓
4. 向量搜索 (searchRelevantContext)
   • 将问题转换为向量
   • 在 Upstash Vector 中搜索
   • 返回 top-5 相关内容块
   ↓
5. 构建提示 (generateSystemPrompt)
   • 基础系统提示
   • 场景特定指导
   • 相关上下文
   • 对话历史
   ↓
6. LLM生成 (generateAIResponse)
   • 调用 Groq API
   • 使用 Llama 3.1 70B
   • 生成个性化回答
   ↓
7. 返回结果
   • 答案内容
   • 场景类型
   • 引用来源
   ↓
8. 显示给用户
```

## 向量数据库结构

### 数据块类型

```javascript
{
  id: string,              // 唯一标识符
  type: string,            // 类型标签
  content: string,         // 文本内容（用于生成向量）
  source: string,          // 来源描述
  category?: string        // 可选分类
}
```

### 块类型分类

1. **personal** - 个人信息
   - 基本资料
   - 职业目标
   - 价值主张

2. **experience** - 工作经验
   - 公司概述
   - STAR成就
   - 领导力示例

3. **skill** - 技能
   - 编程语言
   - AI/ML技能
   - 数据库
   - 云平台
   - 软技能

4. **project** - 项目
   - 项目描述
   - 技术栈
   - 影响和结果

5. **education** - 教育
   - 在读学位
   - 已获学位
   - 课程

6. **interview_prep** - 面试准备
   - 行为问题
   - 技术问题
   - 情景问题

## 面试场景系统

### 场景识别

```javascript
analyzeQuestionType(question) {
  // 基于关键词和问题结构识别场景
  // 返回: 'screening' | 'hr' | 'technical' | 'manager' | 'executive'
}
```

### 场景特定提示

每种场景有定制的系统提示：

**Screening (电话筛选)**
- 简洁回答 (30-60秒)
- 确认资格
- 薪资期望
- 可用性

**HR (人力资源)**
- 文化契合
- STAR详细回答
- 职业动机
- 团队协作

**Technical (技术)**
- 技术深度
- 架构决策
- 代码质量
- 学习能力

**Manager (管理层)**
- 业务影响
- ROI导向
- 主动性
- 优先级管理

**Executive (高管)**
- 战略思维
- 长期愿景
- 行业洞察
- 文化贡献

## 技术栈详解

### 前端
- **Next.js 14**: React框架，支持SSR和API路由
- **TypeScript**: 类型安全
- **Tailwind CSS**: 实用优先的CSS框架
- **Lucide React**: 图标库

### 后端
- **Next.js API Routes**: 无服务器函数
- **Upstash Vector**: 托管向量数据库
- **Groq SDK**: LLM API客户端

### AI/ML
- **RAG架构**: 检索增强生成
- **向量嵌入**: 语义搜索
- **Llama 3.1 70B**: 开源LLM模型
- **提示工程**: 场景特定优化

### 部署
- **Vercel**: 边缘网络部署
- **环境变量**: 安全的API密钥管理
- **CI/CD**: Git推送自动部署

## 性能优化

### 响应时间
- **向量搜索**: <100ms
- **LLM生成**: ~1.5s
- **总响应**: <2s

### 优化策略
1. **边缘缓存**: Vercel边缘函数
2. **流式响应**: 可选流式LLM输出
3. **批量查询**: 向量搜索优化
4. **连接池**: API连接复用

## 安全性

### API密钥管理
- 环境变量存储
- 服务器端验证
- 不在客户端暴露

### 数据隐私
- 仅存储公开档案信息
- 不收集用户输入
- 遵循GDPR原则

## 可扩展性

### 未来增强
1. **多语言支持**: 中英文切换
2. **语音交互**: 语音问答
3. **分析仪表板**: 问题统计
4. **A/B测试**: 回答质量优化
5. **知识更新**: 定期刷新数据

### 定制化
- 修改 `digitaltwin.json` 更换个人信息
- 调整 `lib/llm.ts` 修改提示策略
- 编辑 `tailwind.config.ts` 更改主题

## 监控和日志

### 生产监控
- Vercel Analytics
- 错误追踪
- API使用量
- 响应时间

### 开发调试
- Console日志
- 错误边界
- TypeScript类型检查
